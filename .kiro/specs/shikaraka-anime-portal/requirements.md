# Requirements Document

## Introduction

ShiKaraKa - это современный аниме-портал с нулевым бюджетом, предоставляющий пользователям возможность искать, просматривать и сохранять избранные аниме. Проект использует бесплатные сервисы (Supabase, Vercel) и интегрируется с Shikimori API для получения данных об аниме. Дизайн выполнен в стиле Modern Dark Cinema с темным фоном (#0a0a0c) и яркими акцентами (#ff0055).

## Glossary

- **System**: Веб-приложение ShiKaraKa
- **User**: Посетитель портала (аутентифицированный или анонимный)
- **Shikimori_API**: Внешний API для получения данных об аниме
- **Supabase**: Backend-платформа для аутентификации и базы данных
- **Video_Player**: Компонент для воспроизведения аниме через адаптивный iframe (16:9)
- **React_Query**: Библиотека для управления серверным состоянием и кэширования данных
- **Anime_Card**: Компонент карточки аниме с постером и информацией
- **Favorites_List**: Список избранных аниме пользователя
- **Skeleton_Screen**: Компонент-заглушка при загрузке данных

## Requirements

### Requirement 1: Главная страница

**User Story:** Как пользователь, я хочу видеть привлекательную главную страницу с популярными аниме, чтобы быстро найти интересный контент.

#### Acceptance Criteria

1. WHEN пользователь открывает главную страницу, THE System SHALL отобразить hero-секцию с названием "ShiKaraKa"
2. WHEN главная страница загружается, THE System SHALL запросить список популярных аниме из Shikimori_API
3. WHILE данные загружаются, THE System SHALL отображать Skeleton_Screen вместо карточек аниме
4. WHEN данные получены, THE System SHALL отобразить сетку Anime_Card с постерами, рейтингом и годом выпуска
5. WHEN пользователь просматривает страницу на мобильном устройстве, THE System SHALL адаптировать сетку под размер экрана

### Requirement 2: Поиск аниме

**User Story:** Как пользователь, я хочу искать аниме по названию на русском или английском языке, чтобы быстро найти нужное произведение.

#### Acceptance Criteria

1. WHEN пользователь вводит текст в поле поиска, THE System SHALL отправить запрос к Shikimori_API с введенным текстом
2. WHILE поиск выполняется, THE System SHALL отображать Skeleton_Screen
3. WHEN результаты поиска получены, THE System SHALL отобразить найденные аниме в виде сетки Anime_Card
4. WHEN результаты поиска пусты, THE System SHALL отобразить сообщение "Ничего не найдено"
5. WHEN пользователь очищает поле поиска, THE System SHALL вернуть отображение популярных аниме

### Requirement 3: Страница просмотра аниме

**User Story:** Как пользователь, я хочу видеть детальную информацию об аниме и смотреть эпизоды, чтобы насладиться контентом.

#### Acceptance Criteria

1. WHEN пользователь выбирает аниме, THE System SHALL отобразить страницу с детальной информацией
2. WHEN страница аниме загружается, THE System SHALL отобразить постер в левой колонке
3. WHEN страница аниме загружается, THE System SHALL отобразить информацию о жанрах, статусе и студии
4. WHEN страница аниме загружается, THE System SHALL инициализировать Video_Player с shikimori_id аниме
5. THE Video_Player SHALL загрузить адаптивный iframe с соотношением сторон 16:9 и доступными русскими озвучками
6. WHEN пользователь просматривает страницу на мобильном устройстве, THE System SHALL переключить layout на одноколоночный и сохранить соотношение сторон 16:9 для Video_Player

### Requirement 4: Аутентификация пользователей

**User Story:** Как пользователь, я хочу зарегистрироваться и войти в систему, чтобы сохранять свои избранные аниме.

#### Acceptance Criteria

1. WHEN пользователь открывает форму регистрации, THE System SHALL отобразить поля для email и пароля
2. WHEN пользователь отправляет форму регистрации с валидными данными, THE System SHALL создать аккаунт через Supabase
3. WHEN пользователь отправляет форму входа с корректными данными, THE System SHALL аутентифицировать пользователя через Supabase
4. WHEN аутентификация успешна, THE System SHALL сохранить сессию пользователя
5. IF email или пароль невалидны, THEN THE System SHALL отобразить сообщение об ошибке
6. WHEN пользователь выходит из системы, THE System SHALL завершить сессию через Supabase

### Requirement 5: Управление избранным

**User Story:** Как аутентифицированный пользователь, я хочу добавлять аниме в избранное, чтобы быстро находить их позже.

#### Acceptance Criteria

1. WHERE пользователь аутентифицирован, THE System SHALL отображать кнопку "Добавить в список" на странице аниме
2. WHEN пользователь нажимает "Добавить в список", THE System SHALL сохранить запись в таблицу favorites в Supabase
3. WHEN аниме уже в избранном, THE System SHALL отображать кнопку "Удалить из списка"
4. WHEN пользователь удаляет аниме из избранного, THE System SHALL удалить запись из таблицы favorites
5. WHERE пользователь не аутентифицирован, THE System SHALL скрывать кнопку управления избранным

### Requirement 6: База данных

**User Story:** Как система, я должна хранить данные пользователей и их избранное, чтобы обеспечить персонализацию.

#### Acceptance Criteria

1. THE System SHALL использовать встроенную таблицу auth.users в Supabase для аутентификации
2. THE System SHALL создать таблицу profiles в Supabase для хранения дополнительных данных профилей пользователей
3. THE System SHALL создать таблицу favorites в Supabase для хранения избранных аниме
4. WHEN пользователь регистрируется, THE System SHALL автоматически создать запись в auth.users через Supabase Auth
5. WHEN пользователь добавляет аниме в избранное, THE System SHALL создать запись с user_id и shikimori_id в таблице favorites
6. THE System SHALL обеспечить связь между таблицами profiles и favorites через foreign key на auth.users.id

### Requirement 7: Интеграция с внешними API

**User Story:** Как система, я должна получать актуальные данные об аниме из Shikimori API, чтобы предоставлять пользователям свежую информацию.

#### Acceptance Criteria

1. WHEN System запрашивает данные об аниме, THE System SHALL использовать Shikimori_API v1 или v2
2. WHEN запрос к Shikimori_API выполняется, THE System SHALL обрабатывать ответ в формате JSON
3. IF Shikimori_API возвращает ошибку, THEN THE System SHALL отобразить сообщение об ошибке пользователю
4. WHEN System получает данные аниме, THE System SHALL извлечь shikimori_id для использования в Video_Player
5. THE System SHALL использовать React_Query для автоматического кэширования данных и управления серверным состоянием
6. WHEN пользователь возвращается на ранее посещенную страницу, THE System SHALL использовать кэшированные данные из React_Query вместо повторного запроса

### Requirement 8: Адаптивный дизайн

**User Story:** Как пользователь мобильного устройства, я хочу комфортно использовать портал на смартфоне, чтобы смотреть аниме в любом месте.

#### Acceptance Criteria

1. WHEN пользователь открывает сайт на экране шириной менее 768px, THE System SHALL применить мобильный layout
2. WHEN отображается сетка аниме на мобильном устройстве, THE System SHALL показывать 1-2 колонки вместо 4-6
3. WHEN отображается страница аниме на мобильном устройстве, THE System SHALL переключить двухколоночный layout на одноколоночный
4. THE System SHALL использовать Tailwind CSS responsive классы для всех компонентов
5. WHEN пользователь взаимодействует с элементами на touch-устройстве, THE System SHALL обеспечить достаточный размер кликабельных областей

### Requirement 9: Обработка ошибок и состояний загрузки

**User Story:** Как пользователь, я хочу видеть понятные индикаторы загрузки и сообщения об ошибках, чтобы понимать состояние системы.

#### Acceptance Criteria

1. WHILE любой асинхронный запрос выполняется, THE System SHALL отображать Skeleton_Screen или индикатор загрузки
2. IF сетевой запрос завершается ошибкой, THEN THE System SHALL отобразить понятное сообщение об ошибке
3. WHEN данные не могут быть загружены, THE System SHALL предложить пользователю повторить попытку
4. THE System SHALL логировать ошибки в консоль для отладки
5. IF Video_Player не может загрузить iframe, THEN THE System SHALL отобразить сообщение о недоступности видео

### Requirement 10: Производительность и оптимизация

**User Story:** Как пользователь, я хочу, чтобы портал загружался быстро и работал плавно, чтобы получить приятный опыт использования.

#### Acceptance Criteria

1. WHEN пользователь загружает страницу, THE System SHALL минимизировать количество запросов к Shikimori_API
2. THE System SHALL использовать lazy loading для изображений постеров
3. THE System SHALL оптимизировать размер bundle через code splitting
4. WHEN данные уже загружены, THE System SHALL использовать кэшированные данные вместо повторных запросов
5. THE System SHALL использовать React.memo и useMemo для предотвращения лишних ре-рендеров

### Requirement 11: Deployment и конфигурация

**User Story:** Как разработчик, я хочу легко развернуть приложение на Vercel, чтобы сделать его доступным пользователям.

#### Acceptance Criteria

1. THE System SHALL использовать переменные окружения для хранения API ключей и конфигурации Supabase
2. WHEN приложение деплоится на Vercel, THE System SHALL автоматически собираться из GitHub репозитория
3. THE System SHALL предоставить .env.example файл с необходимыми переменными окружения
4. THE System SHALL включать документацию по настройке Supabase проекта
5. THE System SHALL включать пошаговую инструкцию по deployment на Vercel
