# üîß –§–∏–Ω–∞–ª—å–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è - ShiKaraKa V2

## –î–∞—Ç–∞: 2026-02-07

---

## üéØ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. ‚úÖ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ - —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å
**–ü—Ä–æ–±–ª–µ–º–∞**: `Could not find a relationship between 'comments' and 'profiles'`

**–†–µ—à–µ–Ω–∏–µ**: 
- –£–±—Ä–∞–ª–∏ —Å–ª–æ–∂–Ω—ã–π JOIN –∑–∞–ø—Ä–æ—Å
- –¢–µ–ø–µ—Ä—å –∑–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–æ—Ñ–∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–º –∑–∞–ø—Ä–æ—Å–æ–º
- –≠—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤—Å–µ–≥–¥–∞, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–µ–π

**–§–∞–π–ª**: `src/services/comments.service.ts`

---

### 2. ‚úÖ –†–µ–π—Ç–∏–Ω–≥–∏ - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ 409
**–ü—Ä–æ–±–ª–µ–º–∞**: –û—à–∏–±–∫–∞ 409 (Conflict) –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –æ—Ü–µ–Ω–∫–∏

**–†–µ—à–µ–Ω–∏–µ**: 
- –ó–∞–º–µ–Ω–∏–ª–∏ `upsert` –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è
- –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –æ—Ü–µ–Ω–∫–∞
- –ï—Å–ª–∏ –µ—Å—Ç—å - –æ–±–Ω–æ–≤–ª—è–µ–º, –µ—Å–ª–∏ –Ω–µ—Ç - —Å–æ–∑–¥–∞–µ–º

**–§–∞–π–ª**: `src/services/ratings.service.ts`

---

### 3. ‚úÖ –í–∫–ª–∞–¥–∫–∏ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ - —É–ª—É—á—à–µ–Ω–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞
**–ü—Ä–æ–±–ª–µ–º–∞**: –í–∫–ª–∞–¥–∫–∏ –Ω–µ –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞—é—Ç—Å—è –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö

**–†–µ—à–µ–Ω–∏–µ**: 
- –î–æ–±–∞–≤–ª–µ–Ω `-mx-4 px-4` –¥–ª—è –ø–æ–ª–Ω–æ–π —à–∏—Ä–∏–Ω—ã –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
- –î–æ–±–∞–≤–ª–µ–Ω `touch-manipulation` –¥–ª—è –ª—É—á—à–µ–≥–æ –æ—Ç–∫–ª–∏–∫–∞
- –£–ª—É—á—à–µ–Ω—ã —Å—Ç–∏–ª–∏ —Å–∫—Ä–æ–ª–ª–±–∞—Ä–∞
- –î–æ–±–∞–≤–ª–µ–Ω `scroll-behavior: smooth`

**–§–∞–π–ª—ã**: 
- `src/pages/Favorites.tsx`
- `src/index.css`

---

## üìã –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥ ‚úÖ
–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —É–∂–µ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –≤ –∫–æ–¥–µ.

### –®–∞–≥ 2: –í—ã–ø–æ–ª–Ω–∏—Ç—å SQL —Å–∫—Ä–∏–ø—Ç –≤ Supabase

1. –û—Ç–∫—Ä–æ–π—Ç–µ **Supabase Dashboard**
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **SQL Editor**
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏–∑ —Ñ–∞–π–ª–∞:
   ```
   supabase/FINAL_FIX_ALL.sql
   ```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç:
- –ü—Ä–æ–≤–µ—Ä–∏—Ç –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã
- –î–æ–±–∞–≤–∏—Ç –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –∫–æ–ª–æ–Ω–∫–∏
- –ü—Ä–æ–≤–µ—Ä–∏—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
- –í–∫–ª—é—á–∏—Ç RLS –Ω–∞ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö

### –®–∞–≥ 3: –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –ø—Ä–æ–µ–∫—Ç

```bash
npm run build
```

### –®–∞–≥ 4: –ó–∞–ø—É—Å—Ç–∏—Ç—å dev —Å–µ—Ä–≤–µ—Ä

```bash
npm run dev
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
1. –û—Ç–∫—Ä–æ–π—Ç–µ –ª—é–±—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –∞–Ω–∏–º–µ
2. –ü—Ä–æ–∫—Ä—É—Ç–∏—Ç–µ –¥–æ —Å–µ–∫—Ü–∏–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
3. ‚úÖ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–æ–ª–∂–Ω—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è
4. ‚úÖ –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π

### –¢–µ—Å—Ç 2: –†–µ–π—Ç–∏–Ω–≥–∏
1. –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∞–Ω–∏–º–µ –Ω–∞–π–¥–∏—Ç–µ –∑–≤–µ–∑–¥—ã —Ä–µ–π—Ç–∏–Ω–≥–∞
2. –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –ª—é–±—É—é –∑–≤–µ–∑–¥—É (1-10)
3. ‚úÖ –û—Ü–µ–Ω–∫–∞ –¥–æ–ª–∂–Ω–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å—Å—è
4. ‚úÖ –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –æ—Ü–µ–Ω–∫—É

### –¢–µ—Å—Ç 3: –í–∫–ª–∞–¥–∫–∏ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É "–ò–∑–±—Ä–∞–Ω–Ω–æ–µ"
2. –ù–∞ –º–æ–±–∏–ª—å–Ω–æ–º: –ø—Ä–æ–≤–µ–¥–∏—Ç–µ –ø–∞–ª—å—Ü–µ–º –ø–æ –≤–∫–ª–∞–¥–∫–∞–º
3. –ù–∞ –¥–µ—Å–∫—Ç–æ–ø–µ: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–ª–µ—Å–∏–∫–æ –º—ã—à–∏
4. ‚úÖ –í—Å–µ –≤–∫–ª–∞–¥–∫–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞

–û—Ç–∫—Ä–æ–π—Ç–µ DevTools (F12) –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

### –î–æ–ª–∂–Ω–æ –±—ã—Ç—å ‚úÖ:
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫ 400
- –†–µ–π—Ç–∏–Ω–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫ 409
- –ù–µ—Ç –∫—Ä–∞—Å–Ω—ã—Ö –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏

### –ï—Å–ª–∏ –≤—Å—ë –µ—â—ë –µ—Å—Ç—å –æ—à–∏–±–∫–∏:

#### –û—à–∏–±–∫–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤:
```
–í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL —Å–∫—Ä–∏–ø—Ç: supabase/FINAL_FIX_ALL.sql
```

#### –û—à–∏–±–∫–∞ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤:
```sql
-- –í Supabase SQL Editor:
DELETE FROM ratings WHERE user_id = '–≤–∞—à_user_id' AND anime_id = 1535;
-- –ó–∞—Ç–µ–º –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞ –ø–æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É
```

---

## üìù –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### src/services/comments.service.ts
```typescript
// –°—Ç–∞—Ä—ã–π –∫–æ–¥ (–Ω–µ —Ä–∞–±–æ—Ç–∞–ª):
.select('*, profiles!comments_user_id_fkey (username, avatar_url)')

// –ù–æ–≤—ã–π –∫–æ–¥ (—Ä–∞–±–æ—Ç–∞–µ—Ç):
.select('*')
// + –æ—Ç–¥–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø—Ä–æ—Ñ–∏–ª–µ–π
```

### src/services/ratings.service.ts
```typescript
// –°—Ç–∞—Ä—ã–π –∫–æ–¥ (–æ—à–∏–±–∫–∞ 409):
.upsert({ anime_id, rating, user_id })

// –ù–æ–≤—ã–π –∫–æ–¥ (—Ä–∞–±–æ—Ç–∞–µ—Ç):
// –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ
// –ó–∞—Ç–µ–º UPDATE –∏–ª–∏ INSERT
```

### src/pages/Favorites.tsx
```typescript
// –î–æ–±–∞–≤–ª–µ–Ω–æ:
className="overflow-x-auto pb-2 -mx-4 px-4 sm:mx-0 sm:px-0"
className="touch-manipulation"
```

---

## üé® –£–ª—É—á—à–µ–Ω–∏—è CSS

### src/index.css
–î–æ–±–∞–≤–ª–µ–Ω—ã —Å—Ç–∏–ª–∏ –¥–ª—è:
- –ü–ª–∞–≤–Ω–æ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ (`scroll-behavior: smooth`)
- Touch-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (`-webkit-overflow-scrolling: touch`)
- –í–∏–¥–∏–º–æ–≥–æ —Å–∫—Ä–æ–ª–ª–±–∞—Ä–∞ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö

---

## ‚úÖ –§–∏–Ω–∞–ª—å–Ω—ã–π —á–µ–∫–ª–∏—Å—Ç

- [x] –ö–æ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω
- [ ] SQL —Å–∫—Ä–∏–ø—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω –≤ Supabase
- [ ] –ü—Ä–æ–µ–∫—Ç –ø–µ—Ä–µ—Å–æ–±—Ä–∞–Ω (`npm run build`)
- [ ] Dev —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω (`npm run dev`)
- [ ] –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] –†–µ–π—Ç–∏–Ω–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
- [ ] –í–∫–ª–∞–¥–∫–∏ –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞—é—Ç—Å—è

---

## üÜò –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞** (Ctrl+Shift+Delete)
2. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ dev —Å–µ—Ä–≤–µ—Ä**
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ Supabase Dashboard** -> Logs
4. **–í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL —Å–∫—Ä–∏–ø—Ç** –µ—â–µ —Ä–∞–∑

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è:
1. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Supabase Logs

**–í—Å–µ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è SQL —Å–∫—Ä–∏–ø—Ç–∞!** üéâ
