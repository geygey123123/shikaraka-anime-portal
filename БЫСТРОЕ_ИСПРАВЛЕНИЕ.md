# ‚ö° –ë–´–°–¢–†–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï - 3 –®–ê–ì–ê

## üéØ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:
1. ‚úÖ –û—à–∏–±–∫–∞ "Could not find a relationship between 'comments' and 'user_id'"
2. ‚úÖ –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤ –∞–¥–º–∏–Ω–∫–µ
3. ‚úÖ –ú–æ–¥–µ—Ä–∞—Ü–∏—è —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –∑–∞—Ö–æ–¥–∞ –≤ –∞–¥–º–∏–Ω–∫—É

---

## üìù –®–ê–ì 1: Supabase SQL (2 –º–∏–Ω—É—Ç—ã)

1. –û—Ç–∫—Ä–æ–π—Ç–µ https://supabase.com/dashboard
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç ‚Üí **SQL Editor**
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —ç—Ç–æ—Ç SQL:

```sql
-- –î–æ–±–∞–≤–∏—Ç—å Foreign Key –¥–ª—è comments
ALTER TABLE public.comments
DROP CONSTRAINT IF EXISTS comments_user_id_fkey;

ALTER TABLE public.comments
ADD CONSTRAINT comments_user_id_fkey
FOREIGN KEY (user_id)
REFERENCES public.profiles(id)
ON DELETE CASCADE;

-- –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã
CREATE INDEX IF NOT EXISTS idx_comments_user_id ON public.comments(user_id);
CREATE INDEX IF NOT EXISTS idx_comments_anime_id ON public.comments(anime_id);
CREATE INDEX IF NOT EXISTS idx_profiles_is_admin ON public.profiles(is_admin);

-- –û–±–Ω–æ–≤–∏—Ç—å —Å—Ö–µ–º—É
NOTIFY pgrst, 'reload schema';
```

4. –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: **Settings** ‚Üí **API** ‚Üí **"Reload PostgREST Schema"**

---

## üöÄ –®–ê–ì 2: –î–µ–ø–ª–æ–π –∫–æ–¥–∞ (1 –º–∏–Ω—É—Ç–∞)

–ö–æ–¥ —É–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω! –ü—Ä–æ—Å—Ç–æ –∑–∞–¥–µ–ø–ª–æ–π—Ç–µ:

```bash
git add .
git commit -m "fix: –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∫–∏ –∏ –º–æ–¥–µ—Ä–∞—Ü–∏–∏"
git push
```

---

## ‚úÖ –®–ê–ì 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ (1 –º–∏–Ω—É—Ç–∞)

1. –û—Ç–∫—Ä–æ–π—Ç–µ `/admin` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–æ–ª–∂–Ω–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è
2. –û—Ç–∫—Ä–æ–π—Ç–µ `/moderation` –Ω–∞–ø—Ä—è–º—É—é - –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–æ–ª–∂–Ω—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å (F12) - –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—à–∏–±–æ–∫

---

## üîß –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è?
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤—ã –∞–¥–º–∏–Ω: `SELECT is_admin FROM profiles WHERE id = auth.uid();`
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ API –≤ Supabase: Settings ‚Üí API ‚Üí Restart

### –ú–æ–¥–µ—Ä–∞—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç?
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ Foreign Key —Å–æ–∑–¥–∞–Ω (–≤—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –∏–∑ –®–∞–≥–∞ 1)
- –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ö–µ–º—É PostgREST (Reload Schema)

### –û—à–∏–±–∫–∞ 403?
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –≤ Supabase
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∞–¥–º–∏–Ω/–º–æ–¥–µ—Ä–∞—Ç–æ—Ä

---

## üìã –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
–°–º–æ—Ç—Ä–∏—Ç–µ `CRITICAL_FIXES_INSTRUCTIONS.md` –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.

## üìÑ SQL —Å–∫—Ä–∏–ø—Ç:
–ü–æ–ª–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –≤ —Ñ–∞–π–ª–µ `supabase/FIX_RELATIONSHIPS_AND_POLICIES.sql`
